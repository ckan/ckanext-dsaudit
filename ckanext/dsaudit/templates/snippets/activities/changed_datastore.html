{% macro resource(act) %}
  <a href="{{ h.dsaudit_resource_url(act.object_id) }}">{{ act.object_id }}</a>
{% endmacro %}

<li class="item {{ activity.activity_type|replace(' ', '-')|lower }}">
  <span class="fa-stack fa-lg">
    <i class="fa fa-circle fa-stack-2x icon"></i>
    <i class="fa fa-icon fa-stack-1x fa-inverse"></i>
  </span>
  {% if activity.data.method == 'insert' %}
    {% set msg=ngettext(
      '{actor} inserted %(num)d record into the datastore resource {resource}',
      '{actor} inserted %(num)d records into the datastore resource {resource}',
      activity.data.records|count) %}
  {% elif activity.data.method == 'update' %}
    {% set msg=ngettext(
      '{actor} updated %(num)d record in the datastore resource {resource}',
      '{actor} updated %(num)d records in the datastore resource {resource}',
      activity.data.records|count) %}
  {% else %}
    {% set msg=ngettext(
      '{actor} upserted %(num)d record into the datastore resource {resource}',
      '{actor} upserted %(num)d records into the datastore resource {resource}',
      activity.data.records|count) %}
  {% endif %}
  {{ msg.format(actor=ah.actor(activity), resource=resource(activity))|safe }}

  {% set cols = h.dsaudit_data_columns(activity.data.records) %}
  <div style="margin: 5px 0 0 80px;">
    <table class="table">
      <thead>
        {% for c in cols %}<td scope="col">{{ c }}</td>{% endfor %}
      </thead>
      <tbody>
        {% for r in activity.data.records %}
          <tr>
            {% for c in cols %}<td>{{ r.get(c, '') }}</td>{% endfor %}
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <span class="date" title="{{ h.render_datetime(activity.timestamp, with_hours=True) }}">
    {{ h.time_ago_from_timestamp(activity.timestamp) }}
  </span>
</li>
